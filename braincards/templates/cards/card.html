{% extends 'base.html' %}

{% block title %}Deck: Java{% endblock %}
{% block header %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
<link rel="stylesheet" href="{{ url_for('static', filename='css/card.css') }}">
{% endblock %}

{% block content %}
<div class="container mt-3 d-flex justify-content-center align-items-center">
    <div class="flashcard-slideshow">
        <div class="flashcard flip flip-vertical d-flex justify-content-center align-items-center">
            <div class="front d-flex justify-content-center align-items-center">
            </div>
            <div class="back d-flex justify-content-center align-items-center">
            </div>
        </div>
    </div>
</div>

<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script>
    var currentIndex = 0;
    var deck = []

    function loadFlashCards() {
        {% for card in cards %}
        card = {
            "front": "{{ card.front_content }}",
            "back": "{{ card.back_content }}"
        }
        deck.push(card)
        {% endfor %}
    }

    function showFlashCard() {
        const card = deck[currentIndex];

        // Update the flashcard content with the parsed data
        var flashcard_slideshow = document.querySelector('.flashcard-slideshow');
        var flashcard = flashcard_slideshow.querySelector('.flashcard');
        flashcard.querySelector('.front').textContent = card.front;
        flashcard.querySelector('.back').textContent = card.back;
    }

    function showNextFlashcard() {
        if (currentIndex > deck.length - 1) {
            currentIndex = deck.length - 1;
            alert("You've reached the end");
            return;
        }
        currentIndex++;

        showFlashCard();
        updateFlashcard(1);
    }

    function showPrevFlashcard() {
        if (currentIndex < 0) {
            currentIndex = 0;
            alert("You've reached the start");
            return;
        }
        currentIndex--;

        showFlashCard();
        updateFlashcard(0);
    }

    function updateFlashcard(direction) {
        const flashcardContent = $(".flashcard");

        if (direction == 0) {
            flashcardContent.addClass("slide-right");
            setTimeout(function () {
                flashcardContent.css("visibility", "hidden");
                flashcardContent.removeClass("slide-right").addClass("slide-left");
                setTimeout(function () {
                    flashcardContent.css("visibility", "visible");
                    flashcardContent.removeClass("slide-left");
                }, 300);
            }, 300);
        } else {
            flashcardContent.addClass("slide-left");
            setTimeout(function () {
                flashcardContent.css("visibility", "hidden");
                flashcardContent.removeClass("slide-left").addClass("slide-right");
                setTimeout(function () {
                    flashcardContent.css("visibility", "visible");
                    flashcardContent.removeClass("slide-right");
                }, 300);
            }, 300);
        }
    }

    const LEFT_ARROW_KEY = 37;
    const RIGHT_ARROW_KEY = 39;

    $(document).ready(function () {
        
        loadFlashCards();

        showFlashCard();

        $(document).keydown(function (e) {
            if (e.which == LEFT_ARROW_KEY) {
                showPrevFlashcard();
            } else if (e.which == RIGHT_ARROW_KEY) {
                showNextFlashcard();
            }
        });

        // Event listener for previous button
        $('#prev').on('click', showPrevFlashcard);

        // Event listener for next button
        $('#next').on('click', showNextFlashcard);
    });
</script>
{% endblock %}